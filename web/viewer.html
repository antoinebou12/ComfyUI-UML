<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Kroki diagram viewer</title>
  <style>
    /* ComfyUI default theme–aligned palette (Settings → Appearance); matches node/canvas colors.
       These are standalone defaults; edit the values below to match a specific ComfyUI theme. */
    :root {
      --comfy-bg-canvas: #222;
      --comfy-bg-node: #353535;
      --comfy-border: #666;
      --comfy-text: #AAA;
      --comfy-text-secondary: #999;
      --comfy-text-highlight: #FFF;
      --comfy-button-bg: #333;
      --comfy-button-hover: #444;
      --comfy-message: #888;
      --comfy-error: #e66;
      --comfy-link: #6af;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: var(--comfy-bg-canvas);
      color: var(--comfy-text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .toolbar {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 14px;
      background: var(--comfy-bg-node);
      border-bottom: 1px solid var(--comfy-border);
      flex-wrap: wrap;
    }
    .toolbar button {
      padding: 6px 12px;
      border: 1px solid var(--comfy-border);
      border-radius: 4px;
      background: var(--comfy-button-bg);
      color: var(--comfy-text);
      cursor: pointer;
      font-size: 13px;
    }
    .toolbar button:hover { background: var(--comfy-button-hover); border-color: var(--comfy-border); }
    .toolbar button:disabled { opacity: 0.5; cursor: not-allowed; }
    .toolbar .zoom-label {
      margin-left: 4px;
      font-size: 12px;
      color: var(--comfy-text-secondary);
    }
    .url-row {
      display: flex;
      align-items: center;
      gap: 8px;
      flex: 1;
      min-width: 200px;
      max-width: 480px;
    }
    .url-input {
      flex: 1;
      min-width: 0;
      padding: 6px 10px;
      border: 1px solid var(--comfy-border);
      border-radius: 4px;
      background: var(--comfy-button-bg);
      color: var(--comfy-text);
      font-size: 13px;
    }
    .url-input::placeholder { color: var(--comfy-text-secondary); }
    .url-input:focus { outline: none; border-color: var(--comfy-link); }
    .url-view-btn {
      flex-shrink: 0;
      padding: 6px 12px;
      border: 1px solid var(--comfy-border);
      border-radius: 4px;
      background: var(--comfy-button-bg);
      color: var(--comfy-text);
      cursor: pointer;
      font-size: 13px;
    }
    .url-view-btn:hover { background: var(--comfy-button-hover); border-color: var(--comfy-border); }
    .toolbar .toolbar-sep {
      width: 1px;
      height: 20px;
      background: var(--comfy-border);
      margin: 0 4px;
    }
    .container {
      flex: 1;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      background: var(--comfy-bg-canvas);
      position: relative;
    }
    .pan-zoom-layer {
      transform-origin: 0 0;
      cursor: grab;
      display: inline-block;
    }
    .container.has-diagram {
      cursor: grab;
    }
    .container.panning {
      cursor: grabbing;
    }
    .container.crop-mode {
      cursor: crosshair;
    }
    .viewport {
      overflow: visible;
      border: 1px solid var(--comfy-border);
      border-radius: 4px;
      background: var(--comfy-bg-node);
      box-shadow: inset 0 0 0 1px rgba(0,0,0,0.2);
      display: block;
    }
    .viewport img { display: block; max-width: none; max-height: none; }
    .viewport svg { display: block; }
    .message {
      padding: 28px 24px;
      text-align: center;
      color: var(--comfy-message);
      font-size: 14px;
      line-height: 1.5;
    }
    .message.error { color: var(--comfy-error); }
    .message a { color: var(--comfy-link); }
    .message code { color: var(--comfy-text-secondary); font-size: 13px; }
    .save-status { position: fixed; bottom: 16px; left: 50%; transform: translateX(-50%); padding: 8px 16px; border-radius: 4px; font-size: 13px; z-index: 10; display: none; }
    .save-status.success { background: var(--comfy-border); color: var(--comfy-text); }
    .save-status.error { background: var(--comfy-error); color: #fff; }
    .toolbar button.active { background: var(--comfy-button-hover); border-color: var(--comfy-link); }
    .toolbar.toolbar-embed { padding: 6px 10px; }
    .toolbar.toolbar-embed [data-embed-hide] { display: none !important; }
    .crop-overlay {
      position: absolute;
      pointer-events: none;
      border: 2px dashed var(--comfy-link);
      background: rgba(106, 175, 255, 0.08);
      box-sizing: border-box;
      display: none;
      z-index: 5;
    }
  </style>
</head>
<body>
  <div class="toolbar" id="toolbar">
    <div class="url-row" data-embed-hide>
      <input type="text" id="url-input" class="url-input" placeholder="Paste Kroki URL or paste above and click View" autocomplete="off">
      <button type="button" id="url-view-btn" class="url-view-btn" title="Load diagram from URL">View</button>
    </div>
    <button type="button" id="zoom-out" data-embed-hide title="Zoom out">−</button>
    <button type="button" id="zoom-fit" title="Fit to view">Fit</button>
    <button type="button" id="zoom-100" data-embed-hide title="100%">100%</button>
    <button type="button" id="zoom-in" data-embed-hide title="Zoom in">+</button>
    <span class="zoom-label" id="zoom-label" data-embed-hide>100%</span>
    <span class="toolbar-sep" aria-hidden="true" data-embed-hide></span>
    <button type="button" id="download" data-embed-hide title="Save diagram to your computer" disabled>Save locally</button>
    <button type="button" id="save-comfy" data-embed-hide title="Save to ComfyUI output/uml/ (only when opened from ComfyUI)" disabled>Save to ComfyUI</button>
    <button type="button" id="copy-link" data-embed-hide title="Copy Kroki URL" disabled>Copy link</button>
    <span class="toolbar-sep" aria-hidden="true" data-embed-hide></span>
    <button type="button" id="crop-btn" data-embed-hide title="Select region to crop" disabled>Crop</button>
    <button type="button" id="clear-selection" data-embed-hide title="Clear selection" style="display: none;">Clear selection</button>
    <button type="button" id="save-crop-local" data-embed-hide title="Save cropped region to your computer" style="display: none;">Save crop locally</button>
    <button type="button" id="save-crop-comfy" data-embed-hide title="Save cropped region to ComfyUI output/uml/" style="display: none;">Save crop to ComfyUI</button>
    <button type="button" id="zoom-to-selection" data-embed-hide title="Zoom to fit selection" style="display: none;">Zoom to selection</button>
    <button type="button" id="copy-image" data-embed-hide title="Copy diagram (or selection) as image" disabled>Copy image</button>
  </div>
  <div class="container">
    <div id="content">
      <div class="message" id="message">Paste the <b>kroki_url</b> from the UML node output into the address bar as <code>?url=<i>kroki_url</i></code>, or add it above to view a diagram.</div>
    </div>
    <div class="crop-overlay" id="crop-overlay" data-embed-hide></div>
  </div>
  <div class="save-status" id="save-status" aria-live="polite" data-embed-hide></div>

  <script type="module" src="viewer_shell.mjs"></script>


</body>
</html>
